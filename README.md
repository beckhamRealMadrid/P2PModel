# P2PModel

**P2PModel**μ€ NAT ν™κ²½ ν•μ—μ„λ„ μ‹¤μ‹κ°„ ν†µμ‹ μ΄ κ°€λ¥ν• **UDP Hole Punching κΈ°λ°μ ν•μ΄λΈλ¦¬λ“ P2P λ„¤νΈμ›ν¬ μ•„ν‚¤ν…μ²**λ¥Ό κµ¬ν„ν•λ©°,  
MMO κ²μ„ μ„λ²„μ— μ μ© κ°€λ¥ν• **Shard κΈ°λ° ν™•μ¥ κµ¬μ΅°**λ¥Ό ν•¨κ» μ„¤κ³„ν• μ‹¤μ „ μ§€ν–¥ ν”„λ΅μ νΈμ…λ‹λ‹¤.

---

## π“ Architecture Overview

### π”· P2P λ¨λΈ κµ¬μ΅°

![P2P Model](./P2PModel.bmp)

- ν΄λΌμ΄μ–ΈνΈλ“¤μ΄ μ„λ΅ μ§μ ‘ μ—°κ²°λλ” **κ·Έλ¬Όν•(Mesh) P2P κµ¬μ΅°**
- μ¤‘μ•™ μ„λ²„ μ—†μ΄λ„ ν†µμ‹  κ°€λ¥
- κ· ν• μ΅ν νΈλν”½ λ¶„μ‚° κµ¬μ΅°

> "κ·Έλ¬Όν• λ¨λΈμ€ λ¨λ“  ν΄λΌμ΄μ–ΈνΈκ°€ Hostκ°€ λλ©° κ° ν΄λΌμ΄μ–ΈνΈλ” λ‹¤λ¥Έ ν΄λΌμ΄μ–ΈνΈλ“¤κ³Ό μ—°κ²°μ„ κµ¬μ„±ν•λ‹¤.  
> μ–΄λ ν• μ½μΌλ΅ λ°μ΄ν„°κ°€ μΉμ°μ³ μ²λ¦¬λμ§€ μ•λ” λ™λ“±ν• μ…μ¥μ΄ λλ©°, κ°μκ°€ λ¨λ‘ μ—°κ²°μ„ μ΄λ£¨κ³  μκΈ° λ•λ¬Έμ— μ›ν•λ” μƒλ€μ™€ μ¦‰μ‹ ν†µμ‹ μ„ ν•  μ μλ‹¤."

---

## π”„ NAT Traversal - UDP Hole Punching

### π”Ή κΈ°λ³Έ μ—°κ²° νλ¦„

![UDP Hole Punching](./UDP_Hole_Punching.bmp)

- NAT ν™κ²½μ ν΄λΌμ΄μ–ΈνΈλ“¤μ΄ μ¤‘κ³„ μ„λ²„λ¥Ό ν†µν•΄ μ„λ΅μ μ™Έλ¶€ μ£Όμ†λ¥Ό μμ‹ 
- μ–‘λ°©ν–¥ UDP ν¨ν‚· μ†΅μ‹ μΌλ΅ NAT ν¬νΈλ¥Ό κ°•μ λ΅ μ—΄μ–΄ μ§μ ‘ ν†µμ‹  μ‹λ„

### π”Ή μ—°κ²° μ΄ν›„ μƒνƒ

![UDP Hole Punching Success](./UDP_Hole_Punching_1.bmp)

- μ„±κ³µ μ‹ μ¤‘κ³„ μ—†μ΄ ν΄λΌμ΄μ–ΈνΈ κ°„ μ§μ ‘ μ—°κ²° μ„±λ¦½
- μ„λ²„λ” μ—°κ²° μ΄ν›„ κ°μ…ν•μ§€ μ•μ

---

## π›° UDP Relay Server (Fallback)

![UDP Relay Server](./UDPRelayServer.bmp)

- Hole Punching μ‹¤ν¨ μ‹ μλ™μΌλ΅ Relay μ„λ²„ κ²½μ 
- λ€μΉ­ NAT, λ°©ν™”λ²½ λ“± μ ν• ν™κ²½μ—μ„λ„ μ—°κ²° λ³΄μ¥
- μ„λ²„λ” UDP Relay μ—­ν• λ§ μν–‰ν•μ—¬ μ§€μ—° μµμ†ν™”

---

## π—ƒ MMO Shard Architecture

![Shard Server Structure](./Shard.bmp)

- MMO κ²μ„ κµ¬μ΅°μ— λ§μ¶ Agent β†’ Lobby β†’ Game κΈ°λ°μ Shard λ‹¨μ„ λ¨λ“ν™” μ„¤κ³„
- Agent Serverλ” DMZμ— μ„μΉν•λ©°, μ™Έλ¶€ ν΄λΌμ΄μ–ΈνΈ μ”μ²­μ„ λ‚΄λ¶€ Shardλ΅ μ•μ „ν•κ² μ¤‘κ³„
- Shardλ” λ‚΄λ¶€λ§(IN)μ— μ„μΉν•λ©°, Lobby / Game / UDP μ„λ²„λ΅ κµ¬μ„±λ λ‹¨μ„ κ²μ„ μ²λ¦¬ μ λ‹›μΌλ΅ λ™μ‘
- Shard λ‹¨μ„λ΅ μν‰ ν™•μ¥μ΄ κ°€λ¥ν•λ©°, μ¥μ•  λ°μƒ μ‹ λ…λ¦½μ μΈ κ²©λ¦¬ μ΄μ©μ΄ μ©μ΄ν•¨
- UDP Hole Punching Serverλ¥Ό ν†µν•΄ NAT ν™κ²½μ—μ„λ„ μ•μ •μ μΈ P2P μ—°κ²°μ„ μ§€μ›

---

## π§ Test Scenario Example

λ‹¤μ–‘ν• NAT μ ν• λ° μ—°κ²° μ΅°κ±΄μ— λ”°λΌ μ•„ν‚¤ν…μ²κ°€ μ–΄λ–»κ² λ°μ‘ν•λ”μ§€ λ…μ‹ν•©λ‹λ‹¤:

| μ‹λ‚λ¦¬μ¤ ID | μ΅°κ±΄ | NAT μ ν• | μμƒ λ™μ‘ | μ‹¤μ  μ²λ¦¬ νλ¦„ |
|-------------|------|----------|------------|----------------|
| TC-01 | A β†” B | Full Cone β†” Full Cone | P2P μ§μ ‘ μ—°κ²° | Hole Punching μ„±κ³µ |
| TC-02 | C β†” D | Restricted Cone β†” Port Restricted | P2P μ—°κ²° μ„±κ³µ | μ–‘λ°©ν–¥ μ‹λ„ ν›„ μ—°κ²° μ„±λ¦½ |
| TC-03 | E β†” F | Symmetric β†” Symmetric | μ‹¤ν¨ β†’ Relay μ‚¬μ© | Fallback μ¤‘κ³„ |
| TC-04 | G β†” H | Full Cone β†” Firewall μ°¨λ‹¨ | P2P μ‹¤ν¨ | Relay μ„λ²„λ΅ μ „ν™ |
| TC-05 | I μ¬μ ‘μ† | NAT νƒ€μ„μ•„μ›ƒ λ°μƒ | μ—°κ²° λκΉ€ | KeepAliveλ΅ μ μ§€ |
| TC-06 | λ¨λ°”μΌ β†” Wi-Fi | 4G β†” κ³µμ κΈ° | κ°„ν—μ  μ—°κ²° | μ¬μ‹λ„ + μ„Έμ… μ¶”μ  |
| TC-07 | λλ¤ NAT ν¬νΈ | Symmetric | μ—°κ²° μ‹¤ν¨ | Relay fallback μ‚¬μ© |

---

## π” κΈ°μ  μ„ νƒ λ°°κ²½ (Why This Architecture)

- κΈ°μ΅΄ MMO κµ¬μ΅°λ” μ„λ²„ μ¤‘μ‹¬ ν†µμ‹ μΌλ΅ **νΈλν”½ λ³‘λ©κ³Ό λΉ„μ© μ¦κ°€** λ¬Έμ κ°€ μμ
- λ³Έ μ•„ν‚¤ν…μ²λ” **P2P ν†µμ‹ μ„ μ°μ„ **, μ‹¤ν¨ μ‹ Relay κ²½λ΅λ΅ λ€μ²΄ν•μ—¬ **λ„¤νΈμ›ν¬ λΉ„μ© μ κ°**
- ν΄λΌμ΄μ–ΈνΈ κ°„ μ§μ ‘ μ—°κ²°μ„ ν†µν•΄ **μ§€μ—° μ‹κ°„ λ‹¨μ¶•**
- `Shard` λ‹¨μ„ λ¶„μ‚° κµ¬μ΅°λ΅ μ„λ²„ ν™•μ¥μ„±κ³Ό κ΄€λ¦¬ μ©μ΄μ„± ν™•λ³΄

---

## π“ License

MIT License

---
